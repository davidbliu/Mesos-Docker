#
# tested and works on ubuntu 14.04
#

sudo apt-get -y update
sudo apt-get -y install curl 
sudo apt-get -y install python-setuptools 
sudo apt-get -y install python-pip 
sudo apt-get -y install python-dev 
sudo apt-get -y install python-protobuf
sudo apt-get -y install openjdk-6-jdk

#
# install docker stuff
#
sudo apt-get -y install docker.io
sudo ln -sf /usr/bin/docker.io /usr/local/bin/docker
sudo sed -i '$acomplete -F _docker docker' /etc/bash_completion.d/docker.io

#
# install mesos
#
curl -fL http://downloads.mesosphere.io/master/ubuntu/14.04/mesos_0.19.0~ubuntu14.04%2B1_amd64.deb -o /tmp/mesos.deb
sudo dpkg -i /tmp/mesos.deb
sudo mkdir -p /etc/mesos-master
echo in_memory | sudo dd of=/etc/mesos-master/registry
curl -fL http://downloads.mesosphere.io/master/ubuntu/14.04/mesos-0.19.0_rc2-py2.7-linux-x86_64.egg -o /tmp/mesos.egg
sudo easy_install /tmp/mesos.egg

#
# configure to use deimos
#
sudo apt-get -y install git
git clone git@git.autodesk.com:t-liuda/deimos.git
sudo python setup.py install

#
# start slave
#
sudo nohup mesos-slave --master=zk://{{ zk_ip }}:2181/mesos --containerizer_path=/usr/local/bin/deimos --isolation=external --hostname={{ host_ip }} start &
